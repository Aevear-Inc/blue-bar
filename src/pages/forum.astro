---
// Import useState for managing form state
import { useState } from 'react';

// Declare grecaptcha as a global variable
declare global {
    var grecaptcha: any;
}
---
<link rel="preconnect" href="https://www.google.com">
<link rel="preconnect" href="https://www.gstatic.com" crossorigin>
<!-- Forum Page Content -->
<h1>Welcome to the Forum</h1>

<!-- Email Form -->
<form id="emailForm">
    <label for="email">Your Email:</label>
    <input type="email" id="email" name="email" required />

    <label for="message">Message:</label>
    <textarea id="message" name="message" required></textarea>
    <button class="g-recaptcha" 
    data-sitekey="6LfZyiQpAAAAADMUcrc0gtIidH-ayxwv2dzAKWXW" 
    data-callback='onSubmit' 
    data-action='submit'>Submit</button>
</form>
<script async src="https://www.google.com/recaptcha/api.js"></script>

<script>
    function onSubmit() {
    const form = document.getElementById('emailForm');
    if (form instanceof HTMLFormElement) {
        form.addEventListener('submit', async (event) => {
            event.preventDefault();

            grecaptcha.ready(function() {
                grecaptcha.execute('6LfZyiQpAAAAADMUcrc0gtIidH-ayxwv2dzAKWXW', {action: 'submit'}).then(function(token:string) {
                    // Add your logic to submit to your server here
                    const formData = new FormData(form);
                    formData.append('recaptcha', token);

                    fetch('/.netlify/functions/sendEmail', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => response.json())
                    .then(data => {
                        alert(data.message);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
                });
            });
        });
    }
}
</script>
<script src="https://www.google.com/recaptcha/api.js"></script>
